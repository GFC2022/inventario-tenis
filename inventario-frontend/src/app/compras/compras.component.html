<h2>Gesti√≥n de Compras</h2>

<!-- Formulario -->
<div class="card p-3 mb-4 shadow-sm">
  <form (ngSubmit)="registrarCompra()" class="row g-3">

    <div class="col-md-6">
      <label for="producto_id" class="form-label">Producto</label>
      <select [(ngModel)]="nuevaCompra.producto_id" name="producto_id" id="producto_id" class="form-select" required>
        <option value="" disabled selected>Selecciona un producto</option>
        <option *ngFor="let p of productos" [value]="p.id">
          {{ p.nombre }} (Stock: {{ p.stock }})
        </option>
      </select>
    </div>

    <div class="col-md-3">
      <label for="cantidad" class="form-label">Cantidad</label>
      <input type="number" [(ngModel)]="nuevaCompra.cantidad" name="cantidad" id="cantidad" 
             class="form-control" placeholder="Ej: 10" required>
    </div>

    <div class="col-md-3">
      <label for="precio_unitario" class="form-label">Precio Unitario</label>
      <input type="number" [(ngModel)]="nuevaCompra.precio_unitario" name="precio_unitario" id="precio_unitario" 
             class="form-control" placeholder="Ej: 1500" required>
    </div>

    <div class="col-md-12">
      <button type="submit" class="btn btn-success w-100">Registrar Compra</button>
    </div>
  </form>
</div>

<!-- Listado -->
<div class="card shadow-sm">
  <div class="card-header bg-success text-white">Historial de Compras</div>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Total</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of compras">
          <td>{{ c.id }}</td>
          <td>{{ c.fecha | date:'short' }}</td>
          <td>{{ c.producto_nombre }}</td>
          <td>{{ c.cantidad }}</td>
          <td>${{ c.precio_unitario }}</td>
          <td>${{ c.cantidad * c.precio_unitario }}</td>
          <td>
            <button class="btn btn-danger btn-sm" (click)="cancelarCompra(c.id)">
              Cancelar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
